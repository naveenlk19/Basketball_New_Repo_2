{"file_path": "Source/BasketBallGame/Variant_Combat/Gameplay/CombatDamageableBox.cpp", "file_id": "Source_BasketBallGame_Variant_Combat_Gameplay_CombatDamageableBox_cpp", "asset_path": "", "doc_id": "qq-793e5392-085e-43ae-b375-5c4dc835cfd6", "referencers": [], "dependencies": [], "content": "// Copyright Epic Games, Inc. All Rights Reserved.\n\n\n#include \"CombatDamageableBox.h\"\n#include \"Components/StaticMeshComponent.h\"\n#include \"TimerManager.h\"\n#include \"Engine/World.h\"\n\nACombatDamageableBox::ACombatDamageableBox()\n{\n\tPrimaryActorTick.bCanEverTick = false;\n\n\t// create the mesh\n\tRootComponent = Mesh = CreateDefaultSubobject<UStaticMeshComponent>(TEXT(\"Mesh\"));\n\n\t// set the collision properties\n\tMesh->SetCollisionProfileName(FName(\"BlockAllDynamic\"));\n\n\t// enable physics\n\tMesh->SetSimulatePhysics(true);\n\n\t// disable navigation relevance so boxes don't affect NavMesh generation\n\tMesh->bNavigationRelevant = false;\n}\n\nvoid ACombatDamageableBox::RemoveFromLevel()\n{\n\t// destroy this actor\n\tDestroy();\n}\n\nvoid ACombatDamageableBox::EndPlay(EEndPlayReason::Type EndPlayReason)\n{\n\tSuper::EndPlay(EndPlayReason);\n\n\t// clear the death timer\n\tGetWorld()->GetTimerManager().ClearTimer(DeathTimer);\n}\n\nvoid ACombatDamageableBox::ApplyDamage(float Damage, AActor* DamageCauser, const FVector& DamageLocation, const FVector& DamageImpulse)\n{\n\t// only process damage if we still have HP\n\tif (CurrentHP > 0.0f)\n\t{\n\t\t// apply the damage\n\t\tCurrentHP -= Damage;\n\n\t\t// are we dead?\n\t\tif (CurrentHP <= 0.0f)\n\t\t{\n\t\t\tHandleDeath();\n\t\t}\n\n\t\t// apply a physics impulse to the box, ignoring its mass\n\t\tMesh->AddImpulseAtLocation(DamageImpulse * Mesh->GetMass(), DamageLocation);\n\n\t\t// call the BP handler to play effects, etc.\n\t\tOnBoxDamaged(DamageLocation, DamageImpulse);\n\t}\n}\n\nvoid ACombatDamageableBox::HandleDeath()\n{\n\t// change the collision object type to Visibility so we ignore most interactions but still retain physics collisions\n\tMesh->SetCollisionObjectType(ECC_Visibility);\n\n\t// call the BP handler to play effects, etc.\n\tOnBoxDestroyed();\n\n\t// set up the death cleanup timer\n\tGetWorld()->GetTimerManager().SetTimer(DeathTimer, this, &ACombatDamageableBox::RemoveFromLevel, DeathDelayTime);\n}\n\nvoid ACombatDamageableBox::ApplyHealing(float Healing, AActor* Healer)\n{\n\t// stub\n}\n\n"}