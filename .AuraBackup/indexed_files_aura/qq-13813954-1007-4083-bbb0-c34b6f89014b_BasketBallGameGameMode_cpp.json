{"file_path": "Source/BasketBallGame/BasketBallGameGameMode.cpp", "file_id": "Source_BasketBallGame_BasketBallGameGameMode_cpp", "asset_path": "", "doc_id": "qq-13813954-1007-4083-bbb0-c34b6f89014b", "referencers": [], "dependencies": [], "content": "\ufeff#include \"BasketBallGameGameMode.h\"\n#include \"BasketballMatchComponent.h\"\n#include \"BasketBallGamePlayerController.h\"\n\nABasketBallGameGameMode::ABasketBallGameGameMode()\n{\n\tMatchComponent = CreateDefaultSubobject<UBasketballMatchComponent>(TEXT(\"MatchComponent\"));\n}\n\nvoid ABasketBallGameGameMode::BeginPlay()\n{\n\tSuper::BeginPlay();\n\n\tUE_LOG(LogTemp, Warning, TEXT(\"GameMode: BeginPlay\"));\n}\n\n// ========================\n// Authority Wrappers\n// ========================\n\nvoid ABasketBallGameGameMode::RegisterShotAttempt()\n{\n\tif (!MatchComponent) return;\n\n\tMatchComponent->RegisterShotAttempt();\n\n\tUE_LOG(LogTemp, Warning, TEXT(\"GameMode: Shot Attempt\"));\n}\n\nvoid ABasketBallGameGameMode::RegisterShotSuccess(int32 PointValue)\n{\n\tif (!MatchComponent) return;\n\n\tMatchComponent->RegisterShotSuccess(PointValue);\n\tif (APlayerController* PC = GetWorld()->GetFirstPlayerController())\n\t{\n\t\tif (ABasketBallGamePlayerController* MyPC = Cast<ABasketBallGamePlayerController>(PC))\n\t\t{\n\t\t\tUE_LOG(LogTemp, Warning, TEXT(\"Calling RefreshHUD\"));\n\t\t\tMyPC->RefreshHUD();\n\t\t}\n\t}\n\n\tUE_LOG(LogTemp, Warning, TEXT(\"GameMode: Shot Success | Points: %d\"), PointValue);\n\t\n\t// Refresh HUD for all players\n\tRefreshAllPlayerHUDs();\n}\n\nvoid ABasketBallGameGameMode::RegisterShotMiss()\n{\n\tif (!MatchComponent) return;\n\n\tMatchComponent->RegisterShotMiss();\n\n\tUE_LOG(LogTemp, Warning, TEXT(\"GameMode: Shot Miss\"));\n\t\n\t// Refresh HUD for all players\n\tRefreshAllPlayerHUDs();\n}\n\n// ========================\n// Read-Only Access (UI)\n// ========================\n\nint32 ABasketBallGameGameMode::GetCurrentScore() const\n{\n\treturn MatchComponent ? MatchComponent->GetPoints() : 0;\n}\n\nint32 ABasketBallGameGameMode::GetTotalAttempts() const\n{\n\treturn MatchComponent ? MatchComponent->GetTotalAttempts() : 0;\n}\n\nint32 ABasketBallGameGameMode::GetSuccessfulShots() const\n{\n\treturn MatchComponent ? MatchComponent->GetSuccessfulShots() : 0;\n}\n\nint32 ABasketBallGameGameMode::GetCurrentStreak() const\n{\n\treturn MatchComponent ? MatchComponent->GetCurrentStreak() : 0;\n}\n\nint32 ABasketBallGameGameMode::GetBestStreak() const\n{\n\treturn MatchComponent ? MatchComponent->GetBestStreak() : 0;\n}\n\nfloat ABasketBallGameGameMode::GetEfficiency() const\n{\n\treturn MatchComponent ? MatchComponent->CalculateEfficiency() : 0.0f;\n}\n\nint32 ABasketBallGameGameMode::GetFinalScore() const\n{\n\treturn MatchComponent ? MatchComponent->CalculateFinalScore() : 0;\n}\n\nint32 ABasketBallGameGameMode::GetXP() const\n{\n\treturn MatchComponent ? MatchComponent->CalculateXP() : 0;\n}\n\nUBasketballMatchComponent* ABasketBallGameGameMode::GetMatchComponent() const\n{\n\treturn MatchComponent;\n}\n\nFBasketballGameSnapshot ABasketBallGameGameMode::GetGameSnapshot() const\n{\n\t// Forward snapshot from MatchComponent (authority)\n\t// GameMode does NOT modify or compute anything\n\tif (!MatchComponent)\n\t{\n\t\treturn FBasketballGameSnapshot(); // Return empty snapshot if no component\n\t}\n\t\n\treturn MatchComponent->GetGameSnapshot();\n}\n\nvoid ABasketBallGameGameMode::RefreshAllPlayerHUDs()\n{\n\t// Trigger HUD refresh for all players (authority only)\n\t// In single-player, this is just the local player\n\t// In multiplayer, this would iterate all PlayerControllers\n\t\n\tif (UWorld* World = GetWorld())\n\t{\n\t\tif (ABasketBallGamePlayerController* PC = Cast<ABasketBallGamePlayerController>(World->GetFirstPlayerController()))\n\t\t{\n\t\t\tPC->RefreshHUD();\n\t\t}\n\t}\n}\n"}