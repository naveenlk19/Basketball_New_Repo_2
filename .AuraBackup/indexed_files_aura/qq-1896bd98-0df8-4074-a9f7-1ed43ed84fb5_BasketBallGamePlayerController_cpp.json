{"file_path": "Source/BasketBallGame/BasketBallGamePlayerController.cpp", "file_id": "Source_BasketBallGame_BasketBallGamePlayerController_cpp", "asset_path": "", "doc_id": "qq-1896bd98-0df8-4074-a9f7-1ed43ed84fb5", "referencers": [], "dependencies": [], "content": "#include \"BasketBAllGamePlayerController.h\"\n#include \"EnhancedInputSubsystems.h\"\n#include \"EnhancedInputComponent.h\"\n#include \"Blueprint/UserWidget.h\"\n#include \"GameFramework/Character.h\"\n#include \"BasketBAllGameGameMode.h\"\n#include \"BasketballHUDWidget.h\"\n\nvoid ABasketBallGamePlayerController::BeginPlay()\n{\n\tSuper::BeginPlay();\n\n\t// ===== HUD =====\n\tif (IsLocalController() && ScoreHUDClass)\n\t{\n\t\tScoreHUD = CreateWidget< UBasketballHUDWidget>(this, ScoreHUDClass);//<UUserWidget>(this, ScoreHUDClass);\n\t\tif (ScoreHUD)\n\t\t{\n\t\t\t// Cast to typed reference for snapshot access\n\t\t\t//BasketballHUD = Cast<UBasketballHUDWidget>(ScoreHUD);\n\t\t\tBasketballHUD = ScoreHUD;\n\t\t\tif (!BasketballHUD)\n\t\t\t{\n\t\t\t\tUE_LOG(LogTemp, Warning, TEXT(\"PlayerController: HUD is not a UBasketballHUDWidget - RefreshHUD will not work\"));\n\t\t\t}\n\t\t\t\n\t\t\tScoreHUD->AddToViewport();\n\t\t\tUE_LOG(LogTemp, Warning, TEXT(\"PlayerController: HUD Created\"));\n\t\t}\n\t}\n\n\t// ===== INPUT MAPPING =====\n\tif (ULocalPlayer* LocalPlayer = GetLocalPlayer())\n\t{\n\t\tif (UEnhancedInputLocalPlayerSubsystem* Subsystem =\n\t\t\tLocalPlayer->GetSubsystem<UEnhancedInputLocalPlayerSubsystem>())\n\t\t{\n\t\t\tif (DefaultMappingContext)\n\t\t\t{\n\t\t\t\tSubsystem->AddMappingContext(DefaultMappingContext, 0);\n\t\t\t\tUE_LOG(LogTemp, Warning, TEXT(\"Input Mapping Added\"));\n\t\t\t}\n\t\t}\n\t}\n}\n\nvoid ABasketBallGamePlayerController::SetupInputComponent()\n{\n\tSuper::SetupInputComponent();\n\n\tif (UEnhancedInputComponent* EnhancedInput =\n\t\tCast<UEnhancedInputComponent>(InputComponent))\n\t{\n\t\tif (MoveAction)\n\t\t\tEnhancedInput->BindAction(MoveAction, ETriggerEvent::Triggered, this, &ABasketBallGamePlayerController::Move);\n\n\t\tif (LookAction)\n\t\t\tEnhancedInput->BindAction(LookAction, ETriggerEvent::Triggered, this, &ABasketBallGamePlayerController::Look);\n\n\t\tif (ShootAction)\n\t\t\tEnhancedInput->BindAction(ShootAction, ETriggerEvent::Started, this, &ABasketBallGamePlayerController::Shoot);\n\t}\n}\n\nvoid ABasketBallGamePlayerController::Move(const FInputActionValue& Value)\n{\n\tFVector2D Input = Value.Get<FVector2D>();\n\t/*if (ACharacter* Character = Cast<ACharacter>(GetPawn()))\n\t{\n\t\tCharacter->AddMovementInput(Character->GetActorForwardVector(), Input.Y);\n\t\tCharacter->AddMovementInput(Character->GetActorRightVector(), Input.X);\n\t}*/\n\tif (APawn* ControlledPawn = GetPawn())\n\t{\n\t\tControlledPawn->AddMovementInput(ControlledPawn->GetActorForwardVector(), Input.Y);\n\t\tControlledPawn->AddMovementInput(ControlledPawn->GetActorRightVector(), Input.X);\n\t}\n}\n\nvoid ABasketBallGamePlayerController::Look(const FInputActionValue& Value)\n{\n\tFVector2D Input = Value.Get<FVector2D>();\n\tAddYawInput(Input.X);\n\tAddPitchInput(Input.Y);\n}\n\nvoid ABasketBallGamePlayerController::Shoot(const FInputActionValue& Value)\n{\n\tUE_LOG(LogTemp, Warning, TEXT(\"Shoot Pressed\"));\n}\n\n// ================= HUD BRIDGE =================\n\nvoid ABasketBallGamePlayerController::RefreshHUD()\n{\n\t// Bridge function: Fetch snapshot from GameMode and forward to HUD\n\t// PlayerController does NOT compute or store any gameplay data\n\t\n\t//if (!BasketballHUD) return;\n\n\tif (ABasketBallGameGameMode* GM = GetWorld()->GetAuthGameMode<ABasketBallGameGameMode>())\n\t{\n\t\tFBasketballGameSnapshot Snapshot = GM->GetGameSnapshot();\n\n\t\tUE_LOG(LogTemp, Warning, TEXT(\"Snapshot Score: %d\"), Snapshot.Score);\n\t\tScoreHUD->RefreshHUD(Snapshot);\n\t\t//BasketballHUD->RefreshHUD(Snapshot);\n\t}\n}\n"}