{"file_path": "Source/BasketBallGame/Variant_Combat/CombatPlayerController.cpp", "file_id": "Source_BasketBallGame_Variant_Combat_CombatPlayerController_cpp", "asset_path": "", "doc_id": "qq-fdcd020f-da38-41d5-ab84-3da0f1519250", "referencers": [], "dependencies": [], "content": "// Copyright Epic Games, Inc. All Rights Reserved.\n\n\n#include \"Variant_Combat/CombatPlayerController.h\"\n#include \"EnhancedInputSubsystems.h\"\n#include \"InputMappingContext.h\"\n#include \"Kismet/GameplayStatics.h\"\n#include \"GameFramework/PlayerStart.h\"\n#include \"CombatCharacter.h\"\n#include \"Engine/LocalPlayer.h\"\n#include \"Engine/World.h\"\n#include \"Blueprint/UserWidget.h\"\n#include \"BasketBallGame.h\"\n#include \"Widgets/Input/SVirtualJoystick.h\"\n\nvoid ACombatPlayerController::BeginPlay()\n{\n\tSuper::BeginPlay();\n\n\t// only spawn touch controls on local player controllers\n\tif (SVirtualJoystick::ShouldDisplayTouchInterface() && IsLocalPlayerController())\n\t{\n\t\t// spawn the mobile controls widget\n\t\tMobileControlsWidget = CreateWidget<UUserWidget>(this, MobileControlsWidgetClass);\n\n\t\tif (MobileControlsWidget)\n\t\t{\n\t\t\t// add the controls to the player screen\n\t\t\tMobileControlsWidget->AddToPlayerScreen(0);\n\n\t\t} else {\n\n\t\t\tUE_LOG(LogBasketBallGame, Error, TEXT(\"Could not spawn mobile controls widget.\"));\n\n\t\t}\n\n\t}\n}\n\nvoid ACombatPlayerController::SetupInputComponent()\n{\n\t// only add IMCs for local player controllers\n\tif (IsLocalPlayerController())\n\t{\n\t\t// add the input mapping context\n\t\tif (UEnhancedInputLocalPlayerSubsystem* Subsystem = ULocalPlayer::GetSubsystem<UEnhancedInputLocalPlayerSubsystem>(GetLocalPlayer()))\n\t\t{\n\t\t\tfor (UInputMappingContext* CurrentContext : DefaultMappingContexts)\n\t\t\t{\n\t\t\t\tSubsystem->AddMappingContext(CurrentContext, 0);\n\t\t\t}\n\n\t\t\t// only add these IMCs if we're not using mobile touch input\n\t\t\tif (!SVirtualJoystick::ShouldDisplayTouchInterface())\n\t\t\t{\n\t\t\t\tfor (UInputMappingContext* CurrentContext : MobileExcludedMappingContexts)\n\t\t\t\t{\n\t\t\t\t\tSubsystem->AddMappingContext(CurrentContext, 0);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nvoid ACombatPlayerController::OnPossess(APawn* InPawn)\n{\n\tSuper::OnPossess(InPawn);\n\n\t// subscribe to the pawn's OnDestroyed delegate\n\tInPawn->OnDestroyed.AddDynamic(this, &ACombatPlayerController::OnPawnDestroyed);\n}\n\nvoid ACombatPlayerController::SetRespawnTransform(const FTransform& NewRespawn)\n{\n\t// save the new respawn transform\n\tRespawnTransform = NewRespawn;\n}\n\nvoid ACombatPlayerController::OnPawnDestroyed(AActor* DestroyedActor)\n{\n\t// spawn a new character at the respawn transform\n\tif (ACombatCharacter* RespawnedCharacter = GetWorld()->SpawnActor<ACombatCharacter>(CharacterClass, RespawnTransform))\n\t{\n\t\t// possess the character\n\t\tPossess(RespawnedCharacter);\n\t}\n}"}