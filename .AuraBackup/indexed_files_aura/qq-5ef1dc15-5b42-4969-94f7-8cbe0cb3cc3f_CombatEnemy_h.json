{"file_path": "Source/BasketBallGame/Variant_Combat/AI/CombatEnemy.h", "file_id": "Source_BasketBallGame_Variant_Combat_AI_CombatEnemy_h", "asset_path": "", "doc_id": "qq-5ef1dc15-5b42-4969-94f7-8cbe0cb3cc3f", "referencers": [], "dependencies": [], "content": "// Copyright Epic Games, Inc. All Rights Reserved.\n\n#pragma once\n\n#include \"CoreMinimal.h\"\n#include \"GameFramework/Character.h\"\n#include \"CombatAttacker.h\"\n#include \"CombatDamageable.h\"\n#include \"Animation/AnimMontage.h\"\n#include \"Engine/TimerHandle.h\"\n#include \"CombatEnemy.generated.h\"\n\nclass UWidgetComponent;\nclass UCombatLifeBar;\nclass UAnimMontage;\n\n/** Completed attack animation delegate for StateTree */\nDECLARE_DELEGATE(FOnEnemyAttackCompleted);\n\n/** Landed delegate for StateTree */\nDECLARE_DELEGATE(FOnEnemyLanded);\n\n/** Enemy died delegate */\nDECLARE_DYNAMIC_MULTICAST_DELEGATE(FOnEnemyDied);\n\n/**\n *  An AI-controlled character with combat capabilities.\n *  Its bundled AI Controller runs logic through StateTree\n */\nUCLASS(abstract)\nclass ACombatEnemy : public ACharacter, public ICombatAttacker, public ICombatDamageable\n{\n\tGENERATED_BODY()\n\n\t/** Life bar widget component */\n\tUPROPERTY(VisibleAnywhere, BlueprintReadOnly, Category=\"Components\", meta = (AllowPrivateAccess = \"true\"))\n\tUWidgetComponent* LifeBar;\n\npublic:\n\t\n\t/** Constructor */\n\tACombatEnemy();\n\nprotected:\n\n\t/** Max amount of HP the character will have on respawn */\n\tUPROPERTY(EditAnywhere, Category=\"Damage\")\n\tfloat MaxHP = 3.0f;\n\npublic:\n\n\t/** Current amount of HP the character has */\n\tUPROPERTY(VisibleAnywhere, BlueprintReadOnly, Category=\"Damage\", meta = (ClampMin = 0, ClampMax = 100))\n\tfloat CurrentHP = 0.0f;\n\nprotected:\n\n\t/** Name of the pelvis bone, for damage ragdoll physics */\n\tUPROPERTY(EditAnywhere, Category=\"Damage\")\n\tFName PelvisBoneName;\n\n\t/** Pointer to the life bar widget */\n\tUPROPERTY(EditAnywhere, Category=\"Damage\")\n\tUCombatLifeBar* LifeBarWidget;\n\n\t/** If true, the character is currently playing an attack animation */\n\tbool bIsAttacking = false;\n\n\t/** Distance ahead of the character that melee attack sphere collision traces will extend */\n\tUPROPERTY(EditAnywhere, Category=\"Melee Attack|Trace\", meta = (ClampMin = 0, ClampMax = 500, Units = \"cm\"))\n\tfloat MeleeTraceDistance = 75.0f;\n\n\t/** Radius of the sphere trace for melee attacks */\n\tUPROPERTY(EditAnywhere, Category=\"Melee Attack|Trace\", meta = (ClampMin = 0, ClampMax = 500, Units = \"cm\"))\n\tfloat MeleeTraceRadius = 50.0f;\n\n\t/** Amount of damage a melee attack will deal */\n\tUPROPERTY(EditAnywhere, Category=\"Melee Attack|Damage\", meta = (ClampMin = 0, ClampMax = 100))\n\tfloat MeleeDamage = 1.0f;\n\n\t/** Amount of knockback impulse a melee attack will apply */\n\tUPROPERTY(EditAnywhere, Category=\"Melee Attack|Damage\", meta = (ClampMin = 0, ClampMax = 1000, Units = \"cm/s\"))\n\tfloat MeleeKnockbackImpulse = 150.0f;\n\n\t/** Amount of upwards impulse a melee attack will apply */\n\tUPROPERTY(EditAnywhere, Category=\"Melee Attack|Damage\", meta = (ClampMin = 0, ClampMax = 1000, Units = \"cm/s\"))\n\tfloat MeleeLaunchImpulse = 350.0f;\n\n\t/** AnimMontage that will play for combo attacks */\n\tUPROPERTY(EditAnywhere, Category=\"Melee Attack|Combo\")\n\tUAnimMontage* ComboAttackMontage;\n\n\t/** Names of the AnimMontage sections that correspond to each stage of the combo attack */\n\tUPROPERTY(EditAnywhere, Category=\"Melee Attack|Combo\")\n\tTArray<FName> ComboSectionNames;\n\n\t/** Target number of attacks in the combo attack string we're playing */\n\tint32 TargetComboCount = 0;\n\n\t/** Index of the current stage of the melee attack combo */\n\tint32 CurrentComboAttack = 0;\n\n\t/** AnimMontage that will play for charged attacks */\n\tUPROPERTY(EditAnywhere, Category=\"Melee Attack|Charged\")\n\tUAnimMontage* ChargedAttackMontage;\n\n\t/** Name of the AnimMontage section that corresponds to the charge loop */\n\tUPROPERTY(EditAnywhere, Category=\"Melee Attack|Charged\")\n\tFName ChargeLoopSection;\n\n\t/** Name of the AnimMontage section that corresponds to the attack */\n\tUPROPERTY(EditAnywhere, Category=\"Melee Attack|Charged\")\n\tFName ChargeAttackSection;\n\n\t/** Minimum number of charge animation loops that will be played by the AI */\n\tUPROPERTY(EditAnywhere, Category=\"Melee Attack|Charged\", meta = (ClampMin = 1, ClampMax = 20))\n\tint32 MinChargeLoops = 2;\n\n\t/** Maximum number of charge animation loops that will be played by the AI */\n\tUPROPERTY(EditAnywhere, Category=\"Melee Attack|Charged\", meta = (ClampMin = 1, ClampMax = 20))\n\tint32 MaxChargeLoops = 5;\n\n\t/** Target number of charge animation loops to play in this charged attack */\n\tint32 TargetChargeLoops = 0;\n\n\t/** Number of charge animation loop currently playing */\n\tint32 CurrentChargeLoop = 0;\n\n\t/** Time to wait before removing this character from the level after it dies */\n\tUPROPERTY(EditAnywhere, Category=\"Death\")\n\tfloat DeathRemovalTime = 5.0f;\n\n\t/** Enemy death timer */\n\tFTimerHandle DeathTimer;\n\n\t/** Attack montage ended delegate */\n\tFOnMontageEnded OnAttackMontageEnded;\n\npublic:\n\t/** Attack completed internal delegate to notify StateTree tasks */\n\tFOnEnemyAttackCompleted OnAttackCompleted;\n\n\t/** Landed internal delegate to notify StateTree tasks. We use this instead of the built-in Landed delegate so we can bind to a Lambda in StateTree tasks */\n\tFOnEnemyLanded OnEnemyLanded;\n\n\t/** Enemy died delegate. Allows external subscribers to respond to enemy death */\n\tUPROPERTY(BlueprintAssignable, Category=\"Events\")\n\tFOnEnemyDied OnEnemyDied;\n\npublic:\n\n\t/** Performs an AI-initiated combo attack. Number of hits will be decided by this character */\n\tvoid DoAIComboAttack();\n\n\t/** Performs an AI-initiated charged attack. Charge time will be decided by this character */\n\tvoid DoAIChargedAttack();\n\n\t/** Called from a delegate when the attack montage ends */\n\tvoid AttackMontageEnded(UAnimMontage* Montage, bool bInterrupted);\n\npublic:\n\n\t// ~begin ICombatAttacker interface\n\n\t/** Performs an attack's collision check */\n\tvirtual void DoAttackTrace(FName DamageSourceBone) override;\n\n\t/** Performs a combo attack's check to continue the string */\n\tUFUNCTION(BlueprintCallable, Category=\"Attacker\")\n\tvirtual void CheckCombo() override;\n\n\t/** Performs a charged attack's check to loop the charge animation */\n\tUFUNCTION(BlueprintCallable, Category=\"Attacker\")\n\tvirtual void CheckChargedAttack() override;\n\n\t// ~end ICombatAttacker interface\n\n\t// ~begin ICombatDamageable interface\n\n\t/** Handles damage and knockback events */\n\tvirtual void ApplyDamage(float Damage, AActor* DamageCauser, const FVector& DamageLocation, const FVector& DamageImpulse) override;\n\n\t/** Handles death events */\n\tvirtual void HandleDeath() override;\n\n\t/** Handles healing events */\n\tvirtual void ApplyHealing(float Healing, AActor* Healer) override;\n\n\t// ~end ICombatDamageable interface\n\nprotected:\n\n\t/** Removes this character from the level after it dies */\n\tvoid RemoveFromLevel();\n\npublic:\n\n\t/** Overrides the default TakeDamage functionality */\n\tvirtual float TakeDamage(float Damage, struct FDamageEvent const& DamageEvent, AController* EventInstigator, AActor* DamageCauser) override;\n\n\t/** Overrides landing to reset damage ragdoll physics */\n\tvirtual void Landed(const FHitResult& Hit) override;\n\nprotected:\n\n\t/** Blueprint handler to play damage received effects */\n\tUFUNCTION(BlueprintImplementableEvent, Category=\"Combat\")\n\tvoid ReceivedDamage(float Damage, const FVector& ImpactPoint, const FVector& DamageDirection);\n\nprotected:\n\n\t/** Gameplay initialization */\n\tvirtual void BeginPlay() override;\n\n\t/** EndPlay cleanup */\n\tvirtual void EndPlay(EEndPlayReason::Type EndPlayReason) override;\n};\n"}