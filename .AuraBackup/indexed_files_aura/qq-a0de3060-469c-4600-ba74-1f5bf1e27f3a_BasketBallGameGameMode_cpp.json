{"file_path": "Source/BasketBallGame/BasketBallGameGameMode.cpp", "file_id": "Source_BasketBallGame_BasketBallGameGameMode_cpp", "asset_path": "", "doc_id": "qq-a0de3060-469c-4600-ba74-1f5bf1e27f3a", "referencers": [], "dependencies": [], "content": "#include \"BasketBallGameGameMode.h\"\n#include \"BasketBallGameState.h\"\n#include \"TimerManager.h\"\n#include \"Engine/World.h\"\n\nABasketBallGameGameMode::ABasketBallGameGameMode()\n{\n    MatchComponent = CreateDefaultSubobject<UBasketballMatchComponent>(TEXT(\"MatchComponent\"));\n    GameStateClass = ABasketBallGameState::StaticClass();\n}\n\nvoid ABasketBallGameGameMode::BeginPlay()\n{\n    Super::BeginPlay();\n    StartMatch();\n}\n\n// ================= TIMER =================\n\nvoid ABasketBallGameGameMode::StartMatch()\n{\n    if (UWorld* World = GetWorld())\n    {\n        World->GetTimerManager().SetTimer(\n            MatchTimerHandle,\n            this,\n            &ABasketBallGameGameMode::UpdateMatchTimer,\n            1.0f,\n            true\n        );\n    }\n\n    UE_LOG(LogTemp, Warning, TEXT(\"GameMode: Match Started\"));\n}\n\nvoid ABasketBallGameGameMode::UpdateMatchTimer()\n{\n    ABasketBallGameState* GS = GetBasketBallGameState();\n    if (!GS) return;\n\n    GS->MatchTimeRemaining--;\n\n    if (GS->MatchTimeRemaining <= 0)\n    {\n        EndMatch();\n    }\n}\n\nvoid ABasketBallGameGameMode::EndMatch()\n{\n    if (UWorld* World = GetWorld())\n    {\n        World->GetTimerManager().ClearTimer(MatchTimerHandle);\n    }\n\n    const int32 FinalScore = MatchComponent->CalculateFinalScore();\n    const int32 FinalXP = MatchComponent->CalculateXP();\n\n    UE_LOG(LogTemp, Warning, TEXT(\"GameMode: Match Ended | FinalScore: %d | XP: %d\"),\n        FinalScore, FinalXP);\n}\n\n// ================= SCORING =================\n\nvoid ABasketBallGameGameMode::RegisterShotAttempt()\n{\n    if (!MatchComponent) return;\n\n    MatchComponent->RegisterShotAttempt();\n\n    if (ABasketBallGameState* GS = GetBasketBallGameState())\n    {\n        GS->UpdateSnapshot(\n            MatchComponent->GetPoints(),\n            MatchComponent->GetTotalAttempts(),\n            MatchComponent->GetSuccessfulShots(),\n            MatchComponent->GetBestStreak(),\n            MatchComponent->CalculateEfficiency(),\n            MatchComponent->CalculateFinalScore()\n        );\n    }\n\n    UE_LOG(LogTemp, Warning, TEXT(\"GameMode: Shot Attempt\"));\n}\n\nvoid ABasketBallGameGameMode::RegisterShotSuccess(int32 PointValue)\n{\n    if (!MatchComponent) return;\n\n    MatchComponent->RegisterShotSuccess(PointValue);\n\n    UE_LOG(LogTemp, Warning, TEXT(\"GameMode: Shot Success | Points: %d\"),\n        MatchComponent->GetPoints());\n}\n\nvoid ABasketBallGameGameMode::RegisterShotMiss()\n{\n    if (!MatchComponent) return;\n\n    MatchComponent->RegisterShotMiss();\n\n    if (ABasketBallGameState* GS = GetBasketBallGameState())\n    {\n        GS->UpdateSnapshot(\n            MatchComponent->GetPoints(),\n            MatchComponent->GetTotalAttempts(),\n            MatchComponent->GetSuccessfulShots(),\n            MatchComponent->GetBestStreak(),\n            MatchComponent->CalculateEfficiency(),\n            MatchComponent->CalculateFinalScore()\n        );\n    }\n\n    UE_LOG(LogTemp, Warning, TEXT(\"GameMode: Shot Miss\"));\n}\n\nABasketBallGameState* ABasketBallGameGameMode::GetBasketBallGameState() const\n{\n    return GetGameState<ABasketBallGameState>();\n}"}