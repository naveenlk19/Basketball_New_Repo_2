{"file_path": "Source/BasketBallGame/Variant_Platforming/PlatformingPlayerController.cpp", "file_id": "Source_BasketBallGame_Variant_Platforming_PlatformingPlayerController_cpp", "asset_path": "", "doc_id": "qq-608c9722-8d6e-428c-b85a-0b34d172bcf8", "referencers": [], "dependencies": [], "content": "// Copyright Epic Games, Inc. All Rights Reserved.\n\n\n#include \"Variant_Platforming/PlatformingPlayerController.h\"\n#include \"EnhancedInputSubsystems.h\"\n#include \"InputMappingContext.h\"\n#include \"Kismet/GameplayStatics.h\"\n#include \"GameFramework/PlayerStart.h\"\n#include \"PlatformingCharacter.h\"\n#include \"Engine/LocalPlayer.h\"\n#include \"Engine/World.h\"\n#include \"Blueprint/UserWidget.h\"\n#include \"BasketBallGame.h\"\n#include \"Widgets/Input/SVirtualJoystick.h\"\n\nvoid APlatformingPlayerController::BeginPlay()\n{\n\tSuper::BeginPlay();\n\n\t// only spawn touch controls on local player controllers\n\tif (SVirtualJoystick::ShouldDisplayTouchInterface() && IsLocalPlayerController())\n\t{\n\t\t// spawn the mobile controls widget\n\t\tMobileControlsWidget = CreateWidget<UUserWidget>(this, MobileControlsWidgetClass);\n\n\t\tif (MobileControlsWidget)\n\t\t{\n\t\t\t// add the controls to the player screen\n\t\t\tMobileControlsWidget->AddToPlayerScreen(0);\n\n\t\t} else {\n\n\t\t\tUE_LOG(LogBasketBallGame, Error, TEXT(\"Could not spawn mobile controls widget.\"));\n\n\t\t}\n\n\t}\n}\n\nvoid APlatformingPlayerController::SetupInputComponent()\n{\n\t// only add IMCs for local player controllers\n\tif (IsLocalPlayerController())\n\t{\n\t\t// add the input mapping context\n\t\tif (UEnhancedInputLocalPlayerSubsystem* Subsystem = ULocalPlayer::GetSubsystem<UEnhancedInputLocalPlayerSubsystem>(GetLocalPlayer()))\n\t\t{\n\t\t\tfor (UInputMappingContext* CurrentContext : DefaultMappingContexts)\n\t\t\t{\n\t\t\t\tSubsystem->AddMappingContext(CurrentContext, 0);\n\t\t\t}\n\n\t\t\t// only add these IMCs if we're not using mobile touch input\n\t\t\tif (!SVirtualJoystick::ShouldDisplayTouchInterface())\n\t\t\t{\n\t\t\t\tfor (UInputMappingContext* CurrentContext : MobileExcludedMappingContexts)\n\t\t\t\t{\n\t\t\t\t\tSubsystem->AddMappingContext(CurrentContext, 0);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nvoid APlatformingPlayerController::OnPossess(APawn* InPawn)\n{\n\tSuper::OnPossess(InPawn);\n\n\t// subscribe to the pawn's OnDestroyed delegate\n\tInPawn->OnDestroyed.AddDynamic(this, &APlatformingPlayerController::OnPawnDestroyed);\n}\n\nvoid APlatformingPlayerController::OnPawnDestroyed(AActor* DestroyedActor)\n{\n\t// find the player start\n\tTArray<AActor*> ActorList;\n\tUGameplayStatics::GetAllActorsOfClass(GetWorld(), APlayerStart::StaticClass(), ActorList);\n\n\tif (ActorList.Num() > 0)\n\t{\n\t\t// spawn a character at the player start\n\t\tconst FTransform SpawnTransform = ActorList[0]->GetActorTransform();\n\n\t\tif (APlatformingCharacter* RespawnedCharacter = GetWorld()->SpawnActor<APlatformingCharacter>(CharacterClass, SpawnTransform))\n\t\t{\n\t\t\t// possess the character\n\t\t\tPossess(RespawnedCharacter);\n\t\t}\n\t}\n}"}