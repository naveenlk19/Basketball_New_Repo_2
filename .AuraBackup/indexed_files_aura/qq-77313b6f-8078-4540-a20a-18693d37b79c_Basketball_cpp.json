{"file_path": "Source/BasketBallGame/Basketball.cpp", "file_id": "Source_BasketBallGame_Basketball_cpp", "asset_path": "", "doc_id": "qq-77313b6f-8078-4540-a20a-18693d37b79c", "referencers": [], "dependencies": [], "content": "// Copyright Epic Games, Inc. All Rights Reserved.\n\n#include \"Basketball.h\"\n#include \"Components/StaticMeshComponent.h\"\n#include \"Components/SphereComponent.h\"\n#include \"GameFramework/Character.h\"\n#include \"Components/SkeletalMeshComponent.h\"\n#include \"Engine/StaticMesh.h\"\n\nABasketBall::ABasketBall()\n{\n\t// Set this actor to call Tick() every frame (not needed for prototype)\n\tPrimaryActorTick.bCanEverTick = false;\n\n\t// Create ball mesh component\n\tBallMesh = CreateDefaultSubobject<UStaticMeshComponent>(TEXT(\"BallMesh\"));\n\tRootComponent = BallMesh;\n\n\t// Setup ball physics\n\tBallMesh->SetSimulatePhysics(true);\n\tBallMesh->SetEnableGravity(true);\n\tBallMesh->SetCollisionEnabled(ECollisionEnabled::QueryAndPhysics);\n\tBallMesh->SetCollisionObjectType(ECollisionChannel::ECC_PhysicsBody);\n\tBallMesh->SetCollisionResponseToAllChannels(ECR_Block);\n\t\n\t// Set mass for basketball feel (approximately 0.62 kg in real life)\n\tBallMesh->SetMassOverrideInKg(NAME_None, 0.62f, true);\n\n\t// Create pickup detection sphere\n\tPickupRadius = CreateDefaultSubobject<USphereComponent>(TEXT(\"PickupRadius\"));\n\tPickupRadius->SetupAttachment(BallMesh);\n\tPickupRadius->InitSphereRadius(150.0f); // 1.5 meter pickup radius\n\tPickupRadius->SetCollisionEnabled(ECollisionEnabled::QueryOnly);\n\tPickupRadius->SetCollisionResponseToAllChannels(ECR_Ignore);\n\tPickupRadius->SetCollisionResponseToChannel(ECC_Pawn, ECR_Overlap);\n\n\t// Initialize state\n\tbIsHeld = false;\n\tBallOwner = nullptr;\n\n\t// Initialize shot tracking\n\tbWasShot = false;\n\tbHasScoredThisShot = false;\n\tShotStartLocation = FVector::ZeroVector;\n}\n\nvoid ABasketBall::BeginPlay()\n{\n\tSuper::BeginPlay();\n\t\n\t// Ball starts on ground with physics enabled\n\tEnablePhysics();\n\t\n\t// ======== PHYSICS VALIDATION LOGGING ========\n\t// Verify collision settings are correct to prevent scoring bugs\n\tif (BallMesh && PickupRadius)\n\t{\n\t\tUE_LOG(LogTemp, Warning, TEXT(\"[Basketball Physics Validation] %s\"), *GetName());\n\t\tUE_LOG(LogTemp, Warning, TEXT(\"  BallMesh Collision Enabled: %d (Expected: 3=QueryAndPhysics)\"), static_cast<int32>(BallMesh->GetCollisionEnabled()));\n\t\tUE_LOG(LogTemp, Warning, TEXT(\"  BallMesh Object Type: %d (Expected: 1=PhysicsBody)\"), static_cast<int32>(BallMesh->GetCollisionObjectType()));\n\t\tUE_LOG(LogTemp, Warning, TEXT(\"  BallMesh Simulating Physics: %d\"), BallMesh->IsSimulatingPhysics());\n\t\tUE_LOG(LogTemp, Warning, TEXT(\"  PickupRadius Collision Enabled: %d (Expected: 1=QueryOnly)\"), static_cast<int32>(PickupRadius->GetCollisionEnabled()));\n\t\tUE_LOG(LogTemp, Warning, TEXT(\"  PickupRadius Generate Overlap Events: %d\"), PickupRadius->GetGenerateOverlapEvents());\n\t}\n\t// ========================================\n}\n\nvoid ABasketBall::EnablePhysics()\n{\n\tif (BallMesh)\n\t{\n\t\tBallMesh->SetSimulatePhysics(true);\n\t\tBallMesh->SetEnableGravity(true);\n\t\tBallMesh->SetCollisionEnabled(ECollisionEnabled::QueryAndPhysics);\n\t}\n}\n\nvoid ABasketBall::DisablePhysics()\n{\n\tif (BallMesh)\n\t{\n\t\tBallMesh->SetSimulatePhysics(false);\n\t\tBallMesh->SetEnableGravity(false);\n\t\tBallMesh->SetCollisionEnabled(ECollisionEnabled::NoCollision);\n\t}\n}\n\nvoid ABasketBall::AttachToCharacter(AActor* Character, FName SocketName)\n{\n\tif (!Character)\n\t{\n\t\treturn;\n\t}\n\n\t// Disable physics while held\n\tDisablePhysics();\n\n\t// Find the character's skeletal mesh component\n\tACharacter* CharacterPtr = Cast<ACharacter>(Character);\n\tif (!CharacterPtr)\n\t{\n\t\treturn;\n\t}\n\t\n\tUSkeletalMeshComponent* MeshComp = CharacterPtr->GetMesh();\n\tif (!MeshComp)\n\t{\n\t\treturn;\n\t}\n\t\n\t// Attach to skeletal mesh socket\n\tFAttachmentTransformRules AttachRules(\n\t\tEAttachmentRule::SnapToTarget,\n\t\tEAttachmentRule::SnapToTarget,\n\t\tEAttachmentRule::SnapToTarget,\n\t\tfalse\n\t);\n\n\tAttachToComponent(MeshComp, AttachRules, SocketName);\n\n\t// Update state\n\tbIsHeld = true;\n\tBallOwner = Character;\n}\n\nvoid ABasketBall::DetachFromCharacter()\n{\n\t// Detach from parent\n\tFDetachmentTransformRules DetachRules(\n\t\tEDetachmentRule::KeepWorld,\n\t\tEDetachmentRule::KeepWorld,\n\t\tEDetachmentRule::KeepWorld,\n\t\tfalse\n\t);\n\n\tDetachFromActor(DetachRules);\n\n\t// Re-enable physics\n\tEnablePhysics();\n\n\t// Update state\n\tbIsHeld = false;\n\tBallOwner = nullptr;\n}\n"}