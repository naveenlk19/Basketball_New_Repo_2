{"file_path": "Source/BasketBallGame/BallHandlerComponent.cpp", "file_id": "Source_BasketBallGame_BallHandlerComponent_cpp", "asset_path": "", "doc_id": "qq-53846617-befb-464a-a50d-fe8a3fe5cf18", "referencers": [], "dependencies": [], "content": "// Copyright Epic Games, Inc. All Rights Reserved.\n\n#include \"BallHandlerComponent.h\"\n#include \"Basketball.h\"\n#include \"GameFramework/Character.h\"\n#include \"Kismet/GameplayStatics.h\"\n#include \"Engine/World.h\"\n\nUBallHandlerComponent::UBallHandlerComponent()\n{\n\t// Component doesn't need to tick\n\tPrimaryComponentTick.bCanEverTick = false;\n\n\t// Default values\n\tBallSocketName = FName(TEXT(\"hand_r\")); // Common socket name for right hand\n\tPickupRange = 200.0f; // 2 meters\n\tCurrentBall = nullptr;\n}\n\nvoid UBallHandlerComponent::BeginPlay()\n{\n\tSuper::BeginPlay();\n}\n\nbool UBallHandlerComponent::TryPickupBall()\n{\n\t// Already holding a ball\n\tif (HasBall())\n\t{\n\t\treturn false;\n\t}\n\n\t// Find nearest ball\n\tABasketball* NearestBall = FindNearestBall();\n\n\tif (!NearestBall)\n\t{\n\t\treturn false;\n\t}\n\n\t// Check if ball can be picked up\n\tif (!NearestBall->CanBePickedUp())\n\t{\n\t\treturn false;\n\t}\n\n\t// Attach ball to character\n\tNearestBall->AttachToCharacter(GetOwner(), BallSocketName);\n\tCurrentBall = NearestBall;\n\n\treturn true;\n}\n\nvoid UBallHandlerComponent::DropBall()\n{\n\tif (!HasBall())\n\t{\n\t\treturn;\n\t}\n\n\t// Detach and enable physics\n\tCurrentBall->DetachFromCharacter();\n\tCurrentBall = nullptr;\n}\n\nABasketball* UBallHandlerComponent::FindNearestBall()\n{\n\tAActor* Owner = GetOwner();\n\tif (!Owner)\n\t{\n\t\treturn nullptr;\n\t}\n\n\tUWorld* World = GetWorld();\n\tif (!World)\n\t{\n\t\treturn nullptr;\n\t}\n\n\t// Get all basketball actors in world\n\tTArray<AActor*> FoundBalls;\n\tUGameplayStatics::GetAllActorsOfClass(World, ABasketball::StaticClass(), FoundBalls);\n\n\tif (FoundBalls.Num() == 0)\n\t{\n\t\treturn nullptr;\n\t}\n\n\t// Find closest ball within range\n\tABasketball* ClosestBall = nullptr;\n\tfloat ClosestDistance = PickupRange;\n\tFVector OwnerLocation = Owner->GetActorLocation();\n\n\tfor (AActor* Actor : FoundBalls)\n\t{\n\t\tABasketball* Ball = Cast<ABasketball>(Actor);\n\t\tif (!Ball || !Ball->CanBePickedUp())\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\n\t\tfloat Distance = FVector::Dist(OwnerLocation, Ball->GetActorLocation());\n\t\tif (Distance < ClosestDistance)\n\t\t{\n\t\t\tClosestDistance = Distance;\n\t\t\tClosestBall = Ball;\n\t\t}\n\t}\n\n\treturn ClosestBall;\n}\n\nvoid UBallHandlerComponent::SetBall(ABasketball* Ball)\n{\n\tif (!Ball)\n\t{\n\t\treturn;\n\t}\n\n\t// Drop current ball if holding one\n\tif (HasBall())\n\t{\n\t\tDropBall();\n\t}\n\n\t// Attach new ball\n\tBall->AttachToCharacter(GetOwner(), BallSocketName);\n\tCurrentBall = Ball;\n}\n"}