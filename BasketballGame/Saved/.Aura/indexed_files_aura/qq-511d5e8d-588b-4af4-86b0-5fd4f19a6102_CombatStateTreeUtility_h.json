{"file_path": "Source/BasketBallGame/Variant_Combat/AI/CombatStateTreeUtility.h", "file_id": "Source_BasketBallGame_Variant_Combat_AI_CombatStateTreeUtility_h", "asset_path": "", "doc_id": "qq-511d5e8d-588b-4af4-86b0-5fd4f19a6102", "referencers": [], "dependencies": [], "content": "// Copyright Epic Games, Inc. All Rights Reserved.\n\n#pragma once\n\n#include \"CoreMinimal.h\"\n#include \"StateTreeTaskBase.h\"\n#include \"StateTreeConditionBase.h\"\n\n#include \"CombatStateTreeUtility.generated.h\"\n\nclass ACharacter;\nclass AAIController;\nclass ACombatEnemy;\n\n/**\n *  Instance data struct for the FStateTreeCharacterGroundedCondition condition\n */\nUSTRUCT()\nstruct FStateTreeCharacterGroundedConditionInstanceData\n{\n\tGENERATED_BODY()\n\t\n\t/** Character to check grounded status on */\n\tUPROPERTY(EditAnywhere, Category = \"Context\")\n\tACharacter* Character;\n\n\t/** If true, the condition passes if the character is not grounded instead */\n\tUPROPERTY(EditAnywhere, Category = \"Condition\")\n\tbool bMustBeOnAir = false;\n};\nSTATETREE_POD_INSTANCEDATA(FStateTreeCharacterGroundedConditionInstanceData);\n\n/**\n *  StateTree condition to check if the character is grounded\n */\nUSTRUCT(DisplayName = \"Character is Grounded\")\nstruct FStateTreeCharacterGroundedCondition : public FStateTreeConditionCommonBase\n{\n\tGENERATED_BODY()\n\n\t/** Set the instance data type */\n\tusing FInstanceDataType = FStateTreeCharacterGroundedConditionInstanceData;\n\tvirtual const UStruct* GetInstanceDataType() const override { return FInstanceDataType::StaticStruct(); }\n\n\t/** Default constructor */\n\tFStateTreeCharacterGroundedCondition() = default;\n\t\n\t/** Tests the StateTree condition */\n\tvirtual bool TestCondition(FStateTreeExecutionContext& Context) const override;\n\n#if WITH_EDITOR\n\n\t/** Provides the description string */\n\tvirtual FText GetDescription(const FGuid& ID, FStateTreeDataView InstanceDataView, const IStateTreeBindingLookup& BindingLookup, EStateTreeNodeFormatting Formatting = EStateTreeNodeFormatting::Text) const override;\n#endif\n\n};\n\n////////////////////////////////////////////////////////////////////\n\n/**\n *  Instance data struct for the Combat StateTree tasks\n */\nUSTRUCT()\nstruct FStateTreeAttackInstanceData\n{\n\tGENERATED_BODY()\n\n\t/** Character that will perform the attack */\n\tUPROPERTY(EditAnywhere, Category = Context)\n\tTObjectPtr<ACombatEnemy> Character;\n};\n\n/**\n *  StateTree task to perform a combo attack\n */\nUSTRUCT(meta=(DisplayName=\"Combo Attack\", Category=\"Combat\"))\nstruct FStateTreeComboAttackTask : public FStateTreeTaskCommonBase\n{\n\tGENERATED_BODY()\n\n\t/* Ensure we're using the correct instance data struct */\n\tusing FInstanceDataType = FStateTreeAttackInstanceData;\n\tvirtual const UStruct* GetInstanceDataType() const override { return FInstanceDataType::StaticStruct(); }\n\n\t/** Runs when the owning state is entered */\n\tvirtual EStateTreeRunStatus EnterState(FStateTreeExecutionContext& Context, const FStateTreeTransitionResult& Transition) const override;\n\n\t/** Runs when the owning state is ended */\n\tvirtual void ExitState(FStateTreeExecutionContext& Context, const FStateTreeTransitionResult& Transition) const override;\n\n#if WITH_EDITOR\n\tvirtual FText GetDescription(const FGuid& ID, FStateTreeDataView InstanceDataView, const IStateTreeBindingLookup& BindingLookup, EStateTreeNodeFormatting Formatting = EStateTreeNodeFormatting::Text) const override;\n#endif // WITH_EDITOR\n};\n\n/**\n *  StateTree task to perform a charged attack\n */\nUSTRUCT(meta=(DisplayName=\"Charged Attack\", Category=\"Combat\"))\nstruct FStateTreeChargedAttackTask : public FStateTreeTaskCommonBase\n{\n\tGENERATED_BODY()\n\n\t/* Ensure we're using the correct instance data struct */\n\tusing FInstanceDataType = FStateTreeAttackInstanceData;\n\tvirtual const UStruct* GetInstanceDataType() const override { return FInstanceDataType::StaticStruct(); }\n\n\t/** Runs when the owning state is entered */\n\tvirtual EStateTreeRunStatus EnterState(FStateTreeExecutionContext& Context, const FStateTreeTransitionResult& Transition) const override;\n\n\t/** Runs when the owning state is ended */\n\tvirtual void ExitState(FStateTreeExecutionContext& Context, const FStateTreeTransitionResult& Transition) const override;\n\n#if WITH_EDITOR\n\tvirtual FText GetDescription(const FGuid& ID, FStateTreeDataView InstanceDataView, const IStateTreeBindingLookup& BindingLookup, EStateTreeNodeFormatting Formatting = EStateTreeNodeFormatting::Text) const override;\n#endif // WITH_EDITOR\n};\n\n/**\n *  StateTree task to wait for the character to land\n */\nUSTRUCT(meta=(DisplayName=\"Wait for Landing\", Category=\"Combat\"))\nstruct FStateTreeWaitForLandingTask : public FStateTreeTaskCommonBase\n{\n\tGENERATED_BODY()\n\n\t/* Ensure we're using the correct instance data struct */\n\tusing FInstanceDataType = FStateTreeAttackInstanceData;\n\tvirtual const UStruct* GetInstanceDataType() const override { return FInstanceDataType::StaticStruct(); }\n\n\t/** Runs when the owning state is entered */\n\tvirtual EStateTreeRunStatus EnterState(FStateTreeExecutionContext& Context, const FStateTreeTransitionResult& Transition) const override;\n\n\t/** Runs when the owning state is ended */\n\tvirtual void ExitState(FStateTreeExecutionContext& Context, const FStateTreeTransitionResult& Transition) const override;\n\n#if WITH_EDITOR\n\tvirtual FText GetDescription(const FGuid& ID, FStateTreeDataView InstanceDataView, const IStateTreeBindingLookup& BindingLookup, EStateTreeNodeFormatting Formatting = EStateTreeNodeFormatting::Text) const override;\n#endif // WITH_EDITOR\n};\n\n////////////////////////////////////////////////////////////////////\n\n/**\n *  Instance data struct for the Face Towards Actor StateTree task\n */\nUSTRUCT()\nstruct FStateTreeFaceActorInstanceData\n{\n\tGENERATED_BODY()\n\n\t/** AI Controller that will determine the focused actor */\n\tUPROPERTY(EditAnywhere, Category = Context)\n\tTObjectPtr<AAIController> Controller;\n\n\t/** Actor that will be faced towards */\n\tUPROPERTY(EditAnywhere, Category = Input)\n\tTObjectPtr<AActor> ActorToFaceTowards;\n};\n\n/**\n *  StateTree task to face an AI-Controlled Pawn towards an Actor\n */\nUSTRUCT(meta=(DisplayName=\"Face Towards Actor\", Category=\"Combat\"))\nstruct FStateTreeFaceActorTask : public FStateTreeTaskCommonBase\n{\n\tGENERATED_BODY()\n\n\t/* Ensure we're using the correct instance data struct */\n\tusing FInstanceDataType = FStateTreeFaceActorInstanceData;\n\tvirtual const UStruct* GetInstanceDataType() const override { return FInstanceDataType::StaticStruct(); }\n\n\t/** Runs when the owning state is entered */\n\tvirtual EStateTreeRunStatus EnterState(FStateTreeExecutionContext& Context, const FStateTreeTransitionResult& Transition) const override;\n\n\t/** Runs when the owning state is ended */\n\tvirtual void ExitState(FStateTreeExecutionContext& Context, const FStateTreeTransitionResult& Transition) const override;\n\n#if WITH_EDITOR\n\tvirtual FText GetDescription(const FGuid& ID, FStateTreeDataView InstanceDataView, const IStateTreeBindingLookup& BindingLookup, EStateTreeNodeFormatting Formatting = EStateTreeNodeFormatting::Text) const override;\n#endif // WITH_EDITOR\n};\n\n////////////////////////////////////////////////////////////////////\n\n/**\n *  Instance data struct for the Face Towards Location StateTree task\n */\nUSTRUCT()\nstruct FStateTreeFaceLocationInstanceData\n{\n\tGENERATED_BODY()\n\n\t/** AI Controller that will determine the focused location */\n\tUPROPERTY(EditAnywhere, Category = Context)\n\tTObjectPtr<AAIController> Controller;\n\n\t/** Location that will be faced towards */\n\tUPROPERTY(EditAnywhere, Category = Parameter)\n\tFVector FaceLocation = FVector::ZeroVector;\n};\n\n/**\n *  StateTree task to face an AI-Controlled Pawn towards a world location\n */\nUSTRUCT(meta=(DisplayName=\"Face Towards Location\", Category=\"Combat\"))\nstruct FStateTreeFaceLocationTask : public FStateTreeTaskCommonBase\n{\n\tGENERATED_BODY()\n\n\t/* Ensure we're using the correct instance data struct */\n\tusing FInstanceDataType = FStateTreeFaceLocationInstanceData;\n\tvirtual const UStruct* GetInstanceDataType() const override { return FInstanceDataType::StaticStruct(); }\n\n\t/** Runs when the owning state is entered */\n\tvirtual EStateTreeRunStatus EnterState(FStateTreeExecutionContext& Context, const FStateTreeTransitionResult& Transition) const override;\n\n\t/** Runs when the owning state is ended */\n\tvirtual void ExitState(FStateTreeExecutionContext& Context, const FStateTreeTransitionResult& Transition) const override;\n\n#if WITH_EDITOR\n\tvirtual FText GetDescription(const FGuid& ID, FStateTreeDataView InstanceDataView, const IStateTreeBindingLookup& BindingLookup, EStateTreeNodeFormatting Formatting = EStateTreeNodeFormatting::Text) const override;\n#endif // WITH_EDITOR\n};\n\n////////////////////////////////////////////////////////////////////\n\n/**\n *  Instance data struct for the Set Character Speed StateTree task\n */\nUSTRUCT()\nstruct FStateTreeSetCharacterSpeedInstanceData\n{\n\tGENERATED_BODY()\n\n\t/** Character that will be affected */\n\tUPROPERTY(EditAnywhere, Category = Context)\n\tTObjectPtr<ACharacter> Character;\n\n\t/** Max ground speed to set for the character */\n\tUPROPERTY(EditAnywhere, Category = Parameter)\n\tfloat Speed = 600.0f;\n};\n\n/**\n *  StateTree task to change a Character's ground speed\n */\nUSTRUCT(meta=(DisplayName=\"Set Character Speed\", Category=\"Combat\"))\nstruct FStateTreeSetCharacterSpeedTask : public FStateTreeTaskCommonBase\n{\n\tGENERATED_BODY()\n\n\t/* Ensure we're using the correct instance data struct */\n\tusing FInstanceDataType = FStateTreeSetCharacterSpeedInstanceData;\n\tvirtual const UStruct* GetInstanceDataType() const override { return FInstanceDataType::StaticStruct(); }\n\n\t/** Runs when the owning state is entered */\n\tvirtual EStateTreeRunStatus EnterState(FStateTreeExecutionContext& Context, const FStateTreeTransitionResult& Transition) const override;\n\n#if WITH_EDITOR\n\tvirtual FText GetDescription(const FGuid& ID, FStateTreeDataView InstanceDataView, const IStateTreeBindingLookup& BindingLookup, EStateTreeNodeFormatting Formatting = EStateTreeNodeFormatting::Text) const override;\n#endif // WITH_EDITOR\n};\n\n////////////////////////////////////////////////////////////////////\n\n/**\n *  Instance data struct for the Get Player Info task\n */\nUSTRUCT()\nstruct FStateTreeGetPlayerInfoInstanceData\n{\n\tGENERATED_BODY()\n\n\t/** Character that owns this task */\n\tUPROPERTY(EditAnywhere, Category = Context)\n\tTObjectPtr<ACharacter> Character;\n\n\t/** Character that owns this task */\n\tUPROPERTY(VisibleAnywhere)\n\tTObjectPtr<ACharacter> TargetPlayerCharacter;\n\n\t/** Last known location for the target */\n\tUPROPERTY(VisibleAnywhere)\n\tFVector TargetPlayerLocation = FVector::ZeroVector;\n\n\t/** Distance to the target */\n\tUPROPERTY(VisibleAnywhere)\n\tfloat DistanceToTarget = 0.0f;\n};\n\n/**\n *  StateTree task to get information about the player character\n */\nUSTRUCT(meta=(DisplayName=\"GetPlayerInfo\", Category=\"Combat\"))\nstruct FStateTreeGetPlayerInfoTask : public FStateTreeTaskCommonBase\n{\n\tGENERATED_BODY()\n\n\t/* Ensure we're using the correct instance data struct */\n\tusing FInstanceDataType = FStateTreeGetPlayerInfoInstanceData;\n\tvirtual const UStruct* GetInstanceDataType() const override { return FInstanceDataType::StaticStruct(); }\n\n\t/** Runs while the owning state is active */\n\tvirtual EStateTreeRunStatus Tick(FStateTreeExecutionContext& Context, const float DeltaTime) const override;\n\n#if WITH_EDITOR\n\tvirtual FText GetDescription(const FGuid& ID, FStateTreeDataView InstanceDataView, const IStateTreeBindingLookup& BindingLookup, EStateTreeNodeFormatting Formatting = EStateTreeNodeFormatting::Text) const override;\n#endif // WITH_EDITOR\n};"}