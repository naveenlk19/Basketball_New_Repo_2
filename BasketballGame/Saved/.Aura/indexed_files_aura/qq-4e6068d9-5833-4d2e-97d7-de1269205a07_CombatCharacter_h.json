{"file_path": "Source/BasketBallGame/Variant_Combat/CombatCharacter.h", "file_id": "Source_BasketBallGame_Variant_Combat_CombatCharacter_h", "asset_path": "", "doc_id": "qq-4e6068d9-5833-4d2e-97d7-de1269205a07", "referencers": [], "dependencies": [], "content": "// Copyright Epic Games, Inc. All Rights Reserved.\n\n#pragma once\n\n#include \"CoreMinimal.h\"\n#include \"GameFramework/Character.h\"\n#include \"CombatAttacker.h\"\n#include \"CombatDamageable.h\"\n#include \"Animation/AnimInstance.h\"\n#include \"CombatCharacter.generated.h\"\n\nclass USpringArmComponent;\nclass UCameraComponent;\nclass UInputAction;\nstruct FInputActionValue;\nclass UCombatLifeBar;\nclass UWidgetComponent;\n\nDECLARE_LOG_CATEGORY_EXTERN(LogCombatCharacter, Log, All);\n\n/**\n *  An enhanced Third Person Character with melee combat capabilities:\n *  - Combo attack string\n *  - Press and hold charged attack\n *  - Damage dealing and reaction\n *  - Death\n *  - Respawning\n */\nUCLASS(abstract)\nclass ACombatCharacter : public ACharacter, public ICombatAttacker, public ICombatDamageable\n{\n\tGENERATED_BODY()\n\n\t/** Camera boom positioning the camera behind the character */\n\tUPROPERTY(VisibleAnywhere, BlueprintReadOnly, Category=\"Components\", meta = (AllowPrivateAccess = \"true\"))\n\tUSpringArmComponent* CameraBoom;\n\n\t/** Follow camera */\n\tUPROPERTY(VisibleAnywhere, BlueprintReadOnly, Category=\"Components\", meta = (AllowPrivateAccess = \"true\"))\n\tUCameraComponent* FollowCamera;\n\n\t/** Life bar widget component */\n\tUPROPERTY(VisibleAnywhere, BlueprintReadOnly, Category=\"Components\", meta = (AllowPrivateAccess = \"true\"))\n\tUWidgetComponent* LifeBar;\n\t\nprotected:\n\n\t/** Jump Input Action */\n\tUPROPERTY(EditAnywhere, Category =\"Input\")\n\tUInputAction* JumpAction;\n\n\t/** Move Input Action */\n\tUPROPERTY(EditAnywhere, Category =\"Input\")\n\tUInputAction* MoveAction;\n\n\t/** Look Input Action */\n\tUPROPERTY(EditAnywhere, Category =\"Input\")\n\tUInputAction* LookAction;\n\n\t/** Mouse Look Input Action */\n\tUPROPERTY(EditAnywhere, Category=\"Input\")\n\tUInputAction* MouseLookAction;\n\n\t/** Combo Attack Input Action */\n\tUPROPERTY(EditAnywhere, Category =\"Input\")\n\tUInputAction* ComboAttackAction;\n\n\t/** Charged Attack Input Action */\n\tUPROPERTY(EditAnywhere, Category =\"Input\")\n\tUInputAction* ChargedAttackAction;\n\n\t/** Max amount of HP the character will have on respawn */\n\tUPROPERTY(EditAnywhere, Category=\"Damage\", meta = (ClampMin = 0, ClampMax = 100))\n\tfloat MaxHP = 5.0f;\n\n\t/** Current amount of HP the character has */\n\tUPROPERTY(VisibleAnywhere, Category=\"Damage\")\n\tfloat CurrentHP = 0.0f;\n\n\t/** Life bar widget fill color */\n\tUPROPERTY(EditAnywhere, Category=\"Damage\")\n\tFLinearColor LifeBarColor;\n\n\t/** Name of the pelvis bone, for damage ragdoll physics */\n\tUPROPERTY(EditAnywhere, Category=\"Damage\")\n\tFName PelvisBoneName;\n\n\t/** Pointer to the life bar widget */\n\tUPROPERTY(EditAnywhere, Category=\"Damage\")\n\tTObjectPtr<UCombatLifeBar> LifeBarWidget;\n\n\t/** Max amount of time that may elapse for a non-combo attack input to not be considered stale */\n\tUPROPERTY(EditAnywhere, Category=\"Melee Attack\", meta = (ClampMin = 0, ClampMax = 5, Units = \"s\"))\n\tfloat AttackInputCacheTimeTolerance = 1.0f;\n\n\t/** Time at which an attack button was last pressed */\n\tfloat CachedAttackInputTime = 0.0f;\n\n\t/** If true, the character is currently playing an attack animation */\n\tbool bIsAttacking = false;\n\n\t/** Distance ahead of the character that melee attack sphere collision traces will extend */\n\tUPROPERTY(EditAnywhere, Category=\"Melee Attack|Trace\", meta = (ClampMin = 0, ClampMax = 500, Units=\"cm\"))\n\tfloat MeleeTraceDistance = 75.0f;\n\n\t/** Radius of the sphere trace for melee attacks */\n\tUPROPERTY(EditAnywhere, Category=\"Melee Attack|Trace\", meta = (ClampMin = 0, ClampMax = 200, Units = \"cm\"))\n\tfloat MeleeTraceRadius = 75.0f;\n\n\t/** Amount of damage a melee attack will deal */\n\tUPROPERTY(EditAnywhere, Category=\"Melee Attack|Damage\", meta = (ClampMin = 0, ClampMax = 100))\n\tfloat MeleeDamage = 1.0f;\n\n\t/** Amount of knockback impulse a melee attack will apply */\n\tUPROPERTY(EditAnywhere, Category=\"Melee Attack|Damage\", meta = (ClampMin = 0, ClampMax = 1000, Units = \"cm/s\"))\n\tfloat MeleeKnockbackImpulse = 250.0f;\n\n\t/** Amount of upwards impulse a melee attack will apply */\n\tUPROPERTY(EditAnywhere, Category=\"Melee Attack|Damage\", meta = (ClampMin = 0, ClampMax = 1000, Units = \"cm/s\"))\n\tfloat MeleeLaunchImpulse = 300.0f;\n\n\t/** AnimMontage that will play for combo attacks */\n\tUPROPERTY(EditAnywhere, Category=\"Melee Attack|Combo\")\n\tUAnimMontage* ComboAttackMontage;\n\n\t/** Names of the AnimMontage sections that correspond to each stage of the combo attack */\n\tUPROPERTY(EditAnywhere, Category=\"Melee Attack|Combo\")\n\tTArray<FName> ComboSectionNames;\n\n\t/** Max amount of time that may elapse for a combo attack input to not be considered stale */\n\tUPROPERTY(EditAnywhere, Category=\"Melee Attack|Combo\", meta = (ClampMin = 0, ClampMax = 5, Units = \"s\"))\n\tfloat ComboInputCacheTimeTolerance = 0.45f;\n\n\t/** Index of the current stage of the melee attack combo */\n\tint32 ComboCount = 0;\n\n\t/** AnimMontage that will play for charged attacks */\n\tUPROPERTY(EditAnywhere, Category=\"Melee Attack|Charged\")\n\tUAnimMontage* ChargedAttackMontage;\n\n\t/** Name of the AnimMontage section that corresponds to the charge loop */\n\tUPROPERTY(EditAnywhere, Category=\"Melee Attack|Charged\")\n\tFName ChargeLoopSection;\n\n\t/** Name of the AnimMontage section that corresponds to the attack */\n\tUPROPERTY(EditAnywhere, Category=\"Melee Attack|Charged\")\n\tFName ChargeAttackSection;\n\n\t/** Flag that determines if the player is currently holding the charged attack input */\n\tbool bIsChargingAttack = false;\n\t\n\t/** If true, the charged attack hold check has been tested at least once */\n\tbool bHasLoopedChargedAttack = false;\n\n\t/** Camera boom length while the character is dead */\n\tUPROPERTY(EditAnywhere, Category=\"Camera\", meta = (ClampMin = 0, ClampMax = 1000, Units = \"cm\"))\n\tfloat DeathCameraDistance = 400.0f;\n\n\t/** Camera boom length when the character respawns */\n\tUPROPERTY(EditAnywhere, Category=\"Camera\", meta = (ClampMin = 0, ClampMax = 1000, Units = \"cm\"))\n\tfloat DefaultCameraDistance = 100.0f;\n\n\t/** Time to wait before respawning the character */\n\tUPROPERTY(EditAnywhere, Category=\"Respawn\", meta = (ClampMin = 0, ClampMax = 10, Units = \"s\"))\n\tfloat RespawnTime = 3.0f;\n\n\t/** Attack montage ended delegate */\n\tFOnMontageEnded OnAttackMontageEnded;\n\n\t/** Character respawn timer */\n\tFTimerHandle RespawnTimer;\n\n\t/** Copy of the mesh's transform so we can reset it after ragdoll animations */\n\tFTransform MeshStartingTransform;\n\npublic:\n\t\n\t/** Constructor */\n\tACombatCharacter();\n\nprotected:\n\n\t/** Called for movement input */\n\tvoid Move(const FInputActionValue& Value);\n\n\t/** Called for looking input */\n\tvoid Look(const FInputActionValue& Value);\n\n\t/** Called for combo attack input */\n\tvoid ComboAttackPressed();\n\n\t/** Called for combo attack input pressed */\n\tvoid ChargedAttackPressed();\n\n\t/** Called for combo attack input released */\n\tvoid ChargedAttackReleased();\n\npublic:\n\n\t/** Handles move inputs from either controls or UI interfaces */\n\tUFUNCTION(BlueprintCallable, Category=\"Input\")\n\tvirtual void DoMove(float Right, float Forward);\n\n\t/** Handles look inputs from either controls or UI interfaces */\n\tUFUNCTION(BlueprintCallable, Category=\"Input\")\n\tvirtual void DoLook(float Yaw, float Pitch);\n\n\t/** Handles combo attack pressed from either controls or UI interfaces */\n\tUFUNCTION(BlueprintCallable, Category=\"Input\")\n\tvirtual void DoComboAttackStart();\n\n\t/** Handles combo attack released from either controls or UI interfaces */\n\tUFUNCTION(BlueprintCallable, Category=\"Input\")\n\tvirtual void DoComboAttackEnd();\n\n\t/** Handles charged attack pressed from either controls or UI interfaces */\n\tUFUNCTION(BlueprintCallable, Category=\"Input\")\n\tvirtual void DoChargedAttackStart();\n\n\t/** Handles charged attack released from either controls or UI interfaces */\n\tUFUNCTION(BlueprintCallable, Category=\"Input\")\n\tvirtual void DoChargedAttackEnd();\n\nprotected:\n\n\t/** Resets the character's current HP to maximum */\n\tvoid ResetHP();\n\n\t/** Performs a combo attack */\n\tvoid ComboAttack();\n\n\t/** Performs a charged attack */\n\tvoid ChargedAttack();\n\n\t/** Called from a delegate when the attack montage ends */\n\tvoid AttackMontageEnded(UAnimMontage* Montage, bool bInterrupted);\n\n\t\npublic:\n\n\t// ~begin CombatAttacker interface\n\n\t/** Performs the collision check for an attack */\n\tvirtual void DoAttackTrace(FName DamageSourceBone) override;\n\n\t/** Performs the combo string check */\n\tvirtual void CheckCombo() override;\n\n\t/** Performs the charged attack hold check */\n\tvirtual void CheckChargedAttack() override;\n\n\t// ~end CombatAttacker interface\n\n\t// ~begin CombatDamageable interface\n\n\t/** Handles damage and knockback events */\n\tvirtual void ApplyDamage(float Damage, AActor* DamageCauser, const FVector& DamageLocation, const FVector& DamageImpulse) override;\n\n\t/** Handles death events */\n\tvirtual void HandleDeath() override;\n\n\t/** Handles healing events */\n\tvirtual void ApplyHealing(float Healing, AActor* Healer) override;\n\n\t// ~end CombatDamageable interface\n\n\t/** Called from the respawn timer to destroy and re-create the character */\n\tvoid RespawnCharacter();\n\npublic:\n\n\t/** Overrides the default TakeDamage functionality */\n\tvirtual float TakeDamage(float Damage, struct FDamageEvent const& DamageEvent, AController* EventInstigator, AActor* DamageCauser) override;\n\n\t/** Overrides landing to reset damage ragdoll physics */\n\tvirtual void Landed(const FHitResult& Hit) override;\n\nprotected:\n\n\t/** Blueprint handler to play damage dealt effects */\n\tUFUNCTION(BlueprintImplementableEvent, Category=\"Combat\")\n\tvoid DealtDamage(float Damage, const FVector& ImpactPoint);\n\n\t/** Blueprint handler to play damage received effects */\n\tUFUNCTION(BlueprintImplementableEvent, Category=\"Combat\")\n\tvoid ReceivedDamage(float Damage, const FVector& ImpactPoint, const FVector& DamageDirection);\n\nprotected:\n\n\t/** Initialization */\n\tvirtual void BeginPlay() override;\n\n\t/** Cleanup */\n\tvirtual void EndPlay(const EEndPlayReason::Type EndPlayReason) override;\n\n\t/** Handles input bindings */\n\tvirtual void SetupPlayerInputComponent(class UInputComponent* PlayerInputComponent) override;\n\n\t/** Handles possessed initialization */\n\tvirtual void NotifyControllerChanged() override;\n\npublic:\n\n\t/** Returns CameraBoom subobject **/\n\tFORCEINLINE class USpringArmComponent* GetCameraBoom() const { return CameraBoom; }\n\n\t/** Returns FollowCamera subobject **/\n\tFORCEINLINE class UCameraComponent* GetFollowCamera() const { return FollowCamera; }\n};\n"}